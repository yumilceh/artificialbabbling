%%Created by: Juan Manuel Acevedo Valle
%%Date: 14th of March 2017
%%Script to get speech-like british english (or anyother) vowels 

clear all
clc

raw_vowels.i = [296.0, 2241.0];
raw_vowels.I = [396.0, 1839.0];
raw_vowels.e = [532.0, 1656.0];
raw_vowels.ae = [667.0, 1565.0]; 
raw_vowels.A = [661.0, 1296.0];
raw_vowels.a = [680.0, 1193.0];                  
raw_vowels.b = [643.0, 1019.0]; 
raw_vowels.c = [480.0, 857.0];
raw_vowels.U = [395.0, 1408.0];
raw_vowels.u = [386.0, 1587.0]; 
raw_vowels.E = [519.0, 1408.0];



vowels = fieldnames(raw_vowels);
n_vowels = max(size(vowels));

% scale =[100,500,1500,3000]';
% scale =[500,1500]';
scale = [1;1];

% Y -> ae

init.A = [-1.854780397967764	-0.5733404022283173	-0.08775055453759295	-0.11186713298617779	1.7514476711020102	-0.8740354989213088	1.3657488463401477	-1.1102829031762598	1.3017488148959018	1.0499140202502075	1 1 1];
init.ae = [-1.3245942162708766	-1.591049719411206	1.6991510700436336	0.8442616325916901	1.6917573180170091	-1.2090821872229376	0.9108459307074774	0.3667093074692369	-0.7012770296569917	0.7510633285873944	1 1 1];
init.I = [-0.6214335782419123	-1.8539114230436766	1.8767575556559493	-1.7531258203121345	-3.269023580418917E-4	-0.5411864847399674	-1.3821249117021903	-0.7638485460945841	-0.5689601436691012	1.520178469005423	1 1 1];
init.U = [-0.10975083182585177	-1.0070598955599337	0.014701406469650014	-0.14406017912285307	1.6311591509841352	0.8396859256597353	-1.662283343888972	1.192720472473264	-1.7802979720210774	-1.5398522324443364	1 1 1];
init.E = [-1.4328087301011179	-1.753138713327902	0.44851358134721897	-1.3520301241188606	-0.24870751155179605	-0.7402315818234535	1.1406906352269695	1.0367867362966248	-1.9767106898136224	-1.832328721881617	1 1 1];
init.a = [-1.612468987400097	-1.9307120597573668	-0.08909809068223051	-0.34777841752892735	1.0970809443652487	-1.8993484570977337	1.600982830666113	-0.2419972608135077	1.9811735696280537	0.6272946416772691	1 1 1];
init.c = [-1.8442687549620076	-0.593209177819118	-1.81894935146398	-1.9944185853644503	1.6084245792395926	-0.32384540344953905	1.2234542736068428	1.6051723232371562	1.3257217555639227	-0.27566553117455994	1 1 1];
init.b = [-0.9907429268527639	-1.867438019072568	-0.2891971359022447	-0.2272372294166729	1.0327565902973186	-0.42907599401431273	1.9971215937265447	0.6572894199434423	1.2633263605415164	0.9367624544568618	1 1 1];
init.e = [-0.07017519313338916	-1.5859476384284243	0.4278218635788096	0.3877695235326337	0.7997673704864288	1.7136533901934587	-0.9807575810669995	0.15684912599535883	-0.9754744012768035	-0.10948965811100209	1 1 1];
init.i = [1.2389568703559704	0.6263836822995259	1.0311729992570777	0.7250466629090075	1.4838592194048497	-0.9183163189584729	1.135108285757795	0.6617563607812458	-0.48471908204658654	-0.595135569383821	1 1 1];
init.u = [0.3671246191575932	-0.8325623834263358	0.5429358942385205	1.5513174884972414	-1.4592315692725535	-1.3674669702398439	-0.8488049156702071	0.626543068923366	-0.7964744140618096	1.384906280403087	1 1 1];

Aeq = [zeros(3,10), eye(3)];

A = [eye(10,13); -eye(10,13); Aeq; -Aeq];
B = [5*ones(10,1); 5*ones(10,1); ones(3,1); -0.1*ones(3,1)];


Beq = [1 1 1]';
Aeq = []; Beq = [];
% 'Algorithm': 'interior-point' (default), 'trust-region-reflective', 'sqp'
% 'sqp-legacy' (optimoptions only), 'active-set'
%% Start with the default options
options = optimoptions('fmincon');
%% Modify options setting
% options = optimoptions(options,'Display', 'off');
% options = optimoptions(options,'MaxIter', MaxIter_Data);
options = optimoptions(options,'TolFun', 1e-20);
options = optimoptions(options,'TolX', 1e-20);
options = optimoptions(options,'TolCon', 1e-20);


 for i = 1:n_vowels
   vowel = raw_vowels.(vowels{i}(:))'./scale;
   x0 = init.(vowels{i}(:))';
   m_conf = fmincon(@(x) diva_fmin(x, vowel),x0,A,B,Aeq,Beq,[],[],[],options);
   motor.(vowels{i}(:)) = m_conf;
   s_tmp = diva_synth(m_conf);
   error.(vowels{i}(:)) = norm(s_tmp(2:3)-vowel);
 end

 for i = 1:n_vowels
    display(['You are listening to my ' vowels{i}(:)])
    arts = repmat(motor.(vowels{i}(:)), [1, 200]) ;
    s = diva_synth(arts, 'sound');
    sound(s, 11025);
    
    try
        h5create('vowels.h5',['/' vowels{i}(:)],[1, 13])
    catch 
        
    end
    h5write('vowels.h5',['/' vowels{i}(:)],motor.(vowels{i}(:))')
    
    input('Press [ENTER] to continue...')
 end